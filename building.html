<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>or1k-elf toolchain (newlib port for OpenRISC)</title>
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="javascripts/main.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  </head>
  <body>

      <header>
        <h1>or1k-elf Toolchain Build Instructions</h1>
      </header>

      <div id="banner">
        <span id="logo"></span>

        <a href="https://github.com/openrisc/newlib" class="button fork"><strong>View On GitHub</strong></a>
      </div><!-- end banner -->

    <div class="wrapper">
      <nav>
	<ul>
	<li><a href="index.html">Home</a></li>
	<li><a href="tutorial.html">Tutorial</a></li>
	<li><a href="building.html">Build Instructions</a></li>
	<li><a href="multicore.html">Multicore Toolchain</a></li>
	</ul>
      </nav>
      <section>

<p>If you can't run on the prebuilt toolchain on your system or want
to do a development build, you can build the toolchain from
scratch. This is not that spectacular nowadays and can take like an
hour at maximum. Nevertheless you need some basic understanding of how
a build GNU process works.</p>

<h3>Preparation</h3>

<p>First of all you need the development packages of
the <tt>mpfr</tt>, <tt>gmp</tt>, <tt>mpc</tt> and <tt>zlib</tt>
libraries on your computer, along with of course the basic GCC
toolchain for your host. On a recent Debian/Ubuntu this is done
with:</p>

<pre><code>sudo apt-get install git libgmp-dev libmpfr-dev libmpc-dev \
    zlib1g-dev texinfo build-essential flex bison
</code></pre>

<p>Next you need to setup the environment for your build
(<tt>PREFIX</tt> to ease the execution of the code below
and <tt>PATH</tt> because later stages need the results from previous
stages):</p>

<pre><code>export PREFIX=/opt/toolchains/or1k-elf
export PATH=$PATH:$PREFIX/bin
</code></pre>

<p>Next you need the git repositories. Of course you can also use the
release snapshot tarballs of the releases. To build from the upstream
repositories:</p>

<pre><code>git clone git://sourceware.org/git/binutils-gdb.git binutils
git clone https://github.com/openrisc/or1k-gcc.git gcc
git clone git://sourceware.org/git/newlib-cygwin.git newlib
git clone https://github.com/openrisc/binutils-gdb.git gdb
</code></pre>

<p>In case you want to build from the development sources you need to
check out the following set of repositories:</p>

<pre><code>git clone https://github.com/openrisc/binutils-gdb.git binutils
git clone https://github.com/openrisc/or1k-gcc.git gcc
git clone https://github.com/openrisc/newlib.git
ln -s binutils gdb
</code></pre>

<p>Those repositories differ from the upstream repositories in that
there might be changes in the upstream code that have not yet been
merged, but also architecture specific code that is not yet in the
upstream distribution.</p>

<p>Of course you may desire to check out a repository for a certain
release by checkout of the respective git tag. Once the repositories
are in your temporary compilation repository, you need to execute the
following sequence to build the entire toolchain.</p>

<h3>Build binutils</h3>

<p>The GNU binutils contain the assembler, linker, <tt>objdump</tt>
and a lot more programs to handle the binary files for a certain
architecture. Those can be directly built standalone:</p>

<pre><code>mkdir build-binutils; cd build-binutils
../binutils/configure --target=or1k-elf --prefix=$PREFIX --enable-shared --disable-itcl --disable-tk --disable-tcl --disable-winsup --disable-gdbtk --disable-libgui --disable-rda --disable-sid --disable-sim --disable-gdb --with-sysroot --disable-newlib --disable-libgloss --with-system-zlib
make
make install
cd ..
</code></pre>

<h3>GCC stage 1</h3>

<p>GCC is built in two stages. First we now need the basic C compiler
to build the C library in the next step:</p>

<pre><code>mkdir build-gcc-stage1; cd build-gcc-stage1
../gcc/configure --target=or1k-elf --prefix=$PREFIX --enable-languages=c --disable-shared --disable-libssp
make
make install
cd ..
</code></pre>

<h3>Newlib</h3>

<p>Now we can build the newlib C library:</p>

<pre><code>mkdir build-newlib; cd build-newlib
../newlib/configure --target=or1k-elf --prefix=$PREFIX
make
make install
cd ..
</code></pre>

<h3>GCC stage 2</h3>

<p>Now we can build the entire GCC and tell it about using newlib:</p>

<pre><code>mkdir build-gcc-stage2; cd build-gcc-stage2
../gcc/configure --target=or1k-elf --prefix=$PREFIX --enable-languages=c,c++ --disable-shared --disable-libssp --with-newlib
make
make install
cd ..
</pre></code>

<h3>GDB</h3>

<p>In the last step, we can now build <tt>gdb</tt> for our
architecture:</p>

<pre><code>mkdir build-gdb; cd build-gdb
../gdb/configure --target=or1k-elf --prefix=$PREFIX --enable-shared --disable-itcl --disable-tk --disable-tcl --disable-winsup --disable-gdbtk --disable-libgui --disable-rda --disable-sid --disable-sim --disable-or1ksim --with-sysroot --disable-newlib --disable-libgloss --disable-gas --disable-ld --disable-binutils --disable-gprof --with-system-zlib
make
make install
cd ..
</code></pre>

<p>Now you are done and have the
binaries <tt>or1k-elf-gcc</tt>, <tt>or1k-elf-gdb</tt>, <tt>or1k-elf-ld</tt>
etc. in <tt>$PREFIX/bin</tt>.</p>

      </section>
      <footer>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://twitter.com/michigangraham">mattgraham</a></small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
  </body>
</html>
